<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>Electron Realm</title>
</head>
<body>

<div id="app"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
<script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
<script type="text/babel">
    function App() {
        return <div className="container">
            <h1 className="mb-3">Electron Realm v.1.0.7</h1>
            <CatList/>
        </div>
    }

    function CatList() {
        const isInit = React.useRef(false);
        const [items, setItems] = React.useState([]);

        async function loadCats(){
            const {items} = await window.api.cats.list({action: 'getCats'});
            setItems(items);
        }

        async function onClickLoad() {
            await loadCats();
        }

        React.useEffect(() => {
            if(!isInit.current) {
                isInit.current = true;
                loadCats({action: 'getCats'})
            }
        }, [items]);

        return <div>
            <div className="row mb-2">
                <div className="col">
                    <h2>Cats</h2>
                </div>
                <div className="col">
                    <button className="btn btn-primary btn-sm" onClick={onClickLoad}>Refresh</button>
                </div>
            </div>

            {items.length > 0 && <table className="table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Age</th>
                    </tr>
                </thead>
                <tbody>
                {items.map(item => <tr key={item.id}>
                    <td>
                        {item.name}
                    </td>
                    <td>
                        {item.age}
                    </td>
                </tr>)}
                </tbody>
            </table>}
        </div>
    }

    ReactDOM.render(<App/>, document.getElementById('app'));

    window.main.receive((data) => {
        console.log('Received from main, data: %s', JSON.stringify(data));
    });

    /*
    window.main.send({message: 'Message from renderer!'});
    window.main.receive((data) => {
        console.log('Received from main, data: %s', JSON.stringify(data));
    });
    */
</script>
</body>
</html>
